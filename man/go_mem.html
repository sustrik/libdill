<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>libdill</title>
  <link rel="stylesheet" type="text/css" href="http://libdill.org/main.css">
</head>
<body>

<h1>libdill: Structured Concurrency for C</h1>

<ul id='toplist'>
<li><a href="http://libdill.org/index.html">Home</a></li>
<li><a href="http://libdill.org/download.html">Download</a></li>
<li><a href="http://libdill.org/documentation.html">Documentation</a></li>
<li><a href="http://libdill.org/tutorial.html">Tutorial</a></li>
</ul>
<h1 id="name">NAME</h1>
<p>go_mem - start a coroutine on a user-supplied stack</p>
<h1 id="synopsis">SYNOPSIS</h1>
<p><strong>#include &lt;libdill.h&gt;</strong></p>
<p><strong>int go_mem(</strong><em>expression</em><strong>, void</strong> *<em>stk</em>, <strong>size_t</strong> <em>stklen</em><strong>);</strong></p>
<h1 id="description">DESCRIPTION</h1>
<p>Launches a coroutine that executes the function invocation passed as argument. The buffer passed in the <em>stk</em> argument will be used as the coroutine's stack. The length of the buffer should be specified in the <em>stklen</em> argument.</p>
<p>The coroutine is executed concurrently, and its lifetime may exceed the lifetime of the caller. The return value of the coroutine, if any, is discarded and cannot be retrieved by the caller.</p>
<p>Any function to be invoked with <strong>go_mem()</strong> must be declared with the <strong>coroutine</strong> specifier.</p>
<p><em>WARNING</em>: Coroutines will most likely work even without the <strong>coroutine</strong> specifier. However, they may fail in random non-deterministic ways, depending on the code in question and the particular combination of a compiler and optimization level. Additionally, arguments to a coroutine must not be function calls. If they are, the program may fail non-deterministically. If you need to pass a result of a computation to a coroutine, do the computation first, and then pass the result as an argument. Instead of:</p>
<pre class="sourceCode c"><code class="sourceCode c">go_mem(bar(foo(a), stk, stklen));</code></pre>
<p>Do this:</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="dt">int</span> a = foo();
go_mem(bar(a), stk, stklen);</code></pre>
<h1 id="return-value">RETURN VALUE</h1>
<p>Returns a coroutine handle. In the case of an error, it returns -1 and sets <em>errno</em> to one of the values below.</p>
<h1 id="errors">ERRORS</h1>
<ul>
<li><strong>ECANCELED</strong>: Current coroutine is in the process of shutting down.<br /></li>
<li><strong>ENOMEM</strong>: Not enough memory to allocate the coroutine stack.</li>
</ul>
<h1 id="example">EXAMPLE</h1>
<pre class="sourceCode c"><code class="sourceCode c">coroutine <span class="dt">void</span> add(<span class="dt">int</span> a, <span class="dt">int</span> b) {
    printf(<span class="st">&quot;%d+%d=%d</span><span class="ch">\n</span><span class="st">&quot;</span>, a, b, a + b);
}

...
<span class="dt">char</span> stk[<span class="dv">16384</span>];
<span class="dt">int</span> h = go_mem(add(<span class="dv">1</span>, <span class="dv">2</span>), stk, <span class="kw">sizeof</span>(stk));</code></pre>
</body>
